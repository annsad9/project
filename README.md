# Анализ аномалий статусов заказов (Project 1)
Стек: SQL, Python(pandas, sqlite3)

Данный скрипт предназначен для анализа и выявления аномалий в изменении статусов заказов. Скрипт подключается к базе данных SQLite, содержащей информацию о заказах и их статусах, и выполняет детальный анализ проблемного заказа.

Основные функции:
1. Подключение к базе данных и извлечение истории статусов всех заказов
2. Расчет времени нахождения каждого заказа в различных статусах
3. Сравнение показателей проблемного заказа со средними значениями по системе
4. Выявление аномалий в процессе обработки заказов

Особенности анализа:
- Преобразование временных меток в формат datetime для точных расчетов
- Использование window-функций pandas для расчета временных интервалов между статусами
- Статистический анализ отклонений длительности статусов проблемного заказа
- Детальный отчет по проблемному заказу с историей всех изменений статусов

Выходные данные:
- Таблица сравнения времени в статусах заказа №123 со средними показателями
- Полная история статусов проблемного заказа с расчетом длительности каждого этапа

Требования:
- Python 3.6+

## Использование
Для работы требуется предварительно созданная база данных с таблицами orders и order_status_log, содержащая тестовые данные с аномалиями. Создать такую БД можно используя [test.py](https://github.com/annsad9/Portfolio/blob/main/test.py) или взять [готовую БД](https://github.com/annsad9/Portfolio/blob/main/data_123.db). Также предварительно необходимо установить некоторые библиотеки

1. Через терминал установить библиотеку для работы с СУБД

```diff
pip install sqlite3
```

2. Через терминал установить библиотеку для обработки и анализа данных, представленных в табличном формате

```diff
pip install pandas
```

3. Через терминал установить пакет для работы с базами данных SQLite с помощью библиотеки pandas в Python

```diff 
pip install pandas-sqlite3
```
# Обращение от пользователя: 
``` Заказ №123 ведет себя странно```
# Выходные данные
## Полная история статусов заказа №123:
* status - статус
* created_at - созаднно
* duration_minutes - продолжительность в мин

|    status  |         created_at|  duration_minutes|
|------------|-------------------|------------------|
|     создан |2024-03-01 09:00:00|              20.0|
|в обработке |2024-03-01 09:20:00|             280.0|
|  доставлен |2024-03-01 14:00:00|            2640.0|
|в обработке |2024-03-03 10:00:00|               NaN|

## Сравнение времени в статусах заказа №123 со средними показателями
* status - статус
* duration_minutes - продолжительность в мин
* avg_duration_minutes -
* duration_vs_avg_percent -

|      status | duration_minutes | avg_duration_minutes | duration_vs_avg_percent|
|-------------|------------------|----------------------|------------------------|
|      создан |             20.0 |                 16.0 |                   25.00|
| в обработке |            280.0 |               1004.0 |                  -72.11|
|   доставлен |           2640.0 |               2640.0 |                    0.00|

# Выводы
## Суть инцидента

Заказ №123 выявил две серьезные проблемы:

* Логическая ошибка: заказ вернулся из статуса «доставлен» в «в обработке», что нарушает бизнес-процессы.
* Временная аномалия: заказ долго оставался в статусе «в обработке», превышая средние показатели системы. Это может указывать на проблемы на этапе обработки.

## Причина
Наиболее вероятные причины:

* Ошибка в коде: возможно, приложение или скрипт изменили статус заказа вручную, минуя стандартный процесс.
* Человеческий фактор: ошибка оператора или менеджера, которые могли повторно запустить процесс обработки заказа, уже доставленного.
* Системная ошибка: хотя это менее вероятно, сбой в API интеграции со службой доставки мог привести к некорректному статусу.
